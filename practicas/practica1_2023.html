<!DOCTYPE html>
<!-- saved from url=(0090)https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>practica1_2023.html</title>
  <meta name="generator" content="Haroopad 0.12.2">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF) repeat scroll 0 0 transparent;background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:medium none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:medium none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:medium none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:none no-repeat scroll 5px -27px #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:none repeat scroll 0 0 #FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:none repeat scroll 0 0 #EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:none repeat scroll 0 0 #75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:#1A3C6C solid 1px;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-bottom-width:0;border-left-width:0;border-right-width:0;border-top-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;max-width:none;min-height:0;outline-color:#112644;outline-style:none;outline-width:0;overflow-x:visible;overflow-y:visible;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;border:0 none;color:#ccc;height:3px;padding:0}hr.underscore{border:0 none!important;height:30px;padding:0;-webkit-margin-before:0;-webkit-margin-after:0}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:#fff url(../img/ajax.gif) no-repeat center center}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}.markdown{padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-break:break-all;word-wrap:break-word}.markdown pre{border-radius:3px;word-break:break-all;word-wrap:break-word;overflow:auto}.markdown pre code{display:block}.markdown pre>code{border:1px solid #ccc;white-space:pre;padding:.5em;margin:0}.markdown code{border-radius:3px;word-break:break-all;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown table{padding:0;border-collapse:collapse;border-spacing:0}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.markdown em.underline{font-style:normal;text-decoration:underline}.markdown strong.highlight{color:#000;padding:0 5px;background-color:#fdffb6;-webkit-box-shadow:#fdffb6 0 0 5px;-moz-box-shadow:#fdffb6 0 0 5px;box-shadow:#fdffb6 0 0 5px}.github{padding:20px;color:#000;font-size:15px;font-family:"Lucida Grande","Lucida Sans Unicode","Lucida Sans",AppleSDGothicNeo-Medium,'Segoe UI','Malgun Gothic',Verdana,Tahoma,sans-serif;background:#fff;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.7em}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-javadoc,.hljs-template_comment{color:#998;font-style:italic}.css .rule .hljs-keyword,.hljs-keyword,.hljs-request,.hljs-status,.hljs-subst,.hljs-winutils,.javascript .hljs-title,.nginx .hljs-title{color:#333;font-weight:700}.hljs-hexcolor,.hljs-number,.ruby .hljs-constant{color:teal}.hljs-phpdoc,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#d14}.coffeescript .hljs-params,.hljs-id,.hljs-title,.scss .hljs-preprocessor{color:#900;font-weight:700}.clojure .hljs-title,.hljs-subst,.javascript .hljs-title,.lisp .hljs-title{font-weight:400}.hljs-class .hljs-title,.hljs-type,.tex .hljs-command,.vhdl .hljs-literal{color:#458;font-weight:700}.django .hljs-tag .hljs-keyword,.hljs-rules .hljs-property,.hljs-tag,.hljs-tag .hljs-title{color:navy;font-weight:400}.hljs-attribute,.hljs-variable,.lisp .hljs-body{color:teal}.hljs-regexp{color:#009926}.hljs-prompt,.hljs-symbol,.lisp .hljs-keyword,.ruby .hljs-symbol .hljs-string,.tex .hljs-special{color:#990073}.clojure .hljs-built_in,.hljs-built_in,.lisp .hljs-title{color:#0086b3}.hljs-cdata,.hljs-doctype,.hljs-pi,.hljs-pragma,.hljs-preprocessor,.hljs-shebang{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.diff .hljs-change{background:#0086b3}.hljs-chunk{color:#aaa}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
<style type="text/css" id="operaUserStyle"></style></head>
<body class="markdown github">

  <p>SED - MSE 2023</p><h1 id="práctica-1---mqtt"><a name="práctica-1---mqtt" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#pr%C3%A1ctica-1---mqtt"></a>Práctica 1 - MQTT</h1><p><br></p><h3 id="actividad-1:-cliente-y-broker-mosquitto"><a name="actividad-1:-cliente-y-broker-mosquitto" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#actividad-1:-cliente-y-broker-mosquitto"></a>Actividad 1: Cliente y broker mosquitto</h3><p>En primer lugar vamos a probar el protocolo MQTT con  <em>mosquitto</em>  corriendo el <em>broker</em>  y el <em>cliente</em> (para suscribirse o publicar mensajes) en la misma PC.</p><p><strong>1.</strong> Antes que nada, abra una terminal y verifique que el broker esté corriendo como servicio:</p><pre><code class="console hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;console&quot;&gt;  $ sudo service mosquitto status
&lt;/code&gt;&lt;/pre&gt;">  $ sudo service mosquitto status
</code></pre><p><strong>2.</strong>  Luego abra dos terminales para trabajar con dos clientes dentro de la misma PC. Una de ellas se utilizará como <em>subscriber</em> y la otra como <em>publisher</em>. En la terminal del subscriber, nos podemos suscribir  al topic <code>"test/topic1"</code> mediante el siguiente comando:</p><pre><code class="console hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;console&quot;&gt;  $ mosquitto_sub -h localhost -t &quot;test/topic1&quot; -v
&lt;/code&gt;&lt;/pre&gt;">  $ mosquitto_sub -h localhost -t "test/topic1" -v
</code></pre><p> El valor <code>localhost</code> corresponde a la IP del broker, que en este caso es la IP <code>127.0.0.1</code> dado que el broker y los clientes estan corriendo en la misma PC. El puerto utilizado en este ejemplo es el que viene por defecto, 1883, ya que no estamos especificando otro, pero si fuera necesario especificarlo debería agregarse  <code>-p [puerto]</code>.</p><p><strong>3.</strong> Estando el cliente subscriptor a la espera, publique un mensaje, por ejemplo <code>"probando mqtt"</code>, dirigido al topic <code>"test/topic1"</code> desde la segunda terminal:</p><pre><code class="console hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;console&quot;&gt; $ mosquitto_pub -h localhost -t &quot;test/topic1&quot; -m &quot;probando mqtt&quot;
&lt;/code&gt;&lt;/pre&gt;"> $ mosquitto_pub -h localhost -t "test/topic1" -m "probando mqtt"
</code></pre><p>Luego de esto,  en la terminal subscriber debería aparecer el mensaje enviado desde el publisher.</p><h3 id="actividad-2:-cliente-esp32---publisher"><a name="actividad-2:-cliente-esp32---publisher" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#actividad-2:-cliente-esp32---publisher"></a>Actividad 2: Cliente ESP32 - publisher</h3><p>En este ejemplo la PC se mantendrá como cliente suscriptor (además de broker) y el nodo ESP32 será el cliente publisher.<br>char msg[50];</p><ol>
<li><p>Descargue la carpeta del proyecto  <strong>/practica1</strong> (<a href="https://campus2.fi.uba.ar/mod/resource/view.php?id=6778">disponible en el campus</a>).</p>
</li>
<li><p>Configuración de red WiFi:  Dentro del proyecto, en el archivo <strong>config.h</strong> encontrá las definiciones de <em>SSID</em> y <em>password</em> para ingresar los datos de su red inalámbrica.</p>
<pre><code class="c hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;c&quot;&gt;/* configuración WIFI */
#define ESP_WIFI_SSID &quot;ssid&quot;     // CONFIG_ESP_WIFI_SSID  // &quot;SSID wifi&quot;
#define ESP_WIFI_PASS &quot;password&quot; // CONFIG_ESP_WIFI_PASS  // &quot;pass wifi&quot;
&lt;/code&gt;&lt;/pre&gt;"><span class="hljs-comment">/* configuración WIFI */</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> ESP_WIFI_SSID "ssid"     <span class="hljs-comment">// CONFIG_ESP_WIFI_SSID  // "SSID wifi"</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> ESP_WIFI_PASS "password" <span class="hljs-comment">// CONFIG_ESP_WIFI_PASS  // "pass wifi"</span></span>
</code></pre>
</li>
</ol><ol>
<li><p>Configuración de Broker: para conectar el ESP32 con el broker, deben configurarse la dirección del broker y el puerto MQTT. En el mismo archivo de configuración, reemplace la definición del broker por la que corresponda en su caso (IP de la PC donde está corriendo mosquitto). El puerto déjelo por defecto en 1883.</p>
<pre><code class="c hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;c&quot;&gt;/*  Configuracion MQTT  */
#define PORT_MQTT 1883            //CONFIG_PORT_MQTT      // default
#define IP_BROKER_MQTT &quot;ip_broker&quot;   //CONFIG_IP_BROKER_MQTT // Broker MQTT
&lt;/code&gt;&lt;/pre&gt;"><span class="hljs-comment">/*  Configuracion MQTT  */</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> PORT_MQTT 1883            <span class="hljs-comment">//CONFIG_PORT_MQTT      // default</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> IP_BROKER_MQTT "ip_broker"   <span class="hljs-comment">//CONFIG_IP_BROKER_MQTT // Broker MQTT</span></span>
</code></pre>
</li>
</ol><ol>
<li><p>Inicialización de MQTT: en <strong>main.c</strong>,  agregue  la inicialización del cliente MQTT en el nodo mediante la función <code>MQTT_init()</code>.</p>
</li>
<li><p>Publicación: vamos a publicar un mensaje periodicamente en el topic <code>"test/topic1"</code>. El dato que vamos a usar como mensaje va a ser la lectura del nivel de potencia de la señal Wifi recibida en el nodo (RSSI). Para obtener el valor de RSSI, utilice la función de la APID <code>WIFI_getRSSI()</code> (tenga en cuenta que devuelve un <code>int8_t</code>). Este valor se deberá obtener periodicamente dentro del loop del programa. Para publicar los mensajes agregue la función  <code>MQTT_publish("test/topic1", msg)</code>, donde <code>msg</code> <strong>debe ser un string</strong> con el mensaje generado (lo que requiere convertir el valor de RSSI a string). Además, para agregar un retardo de 1 segundo entre publicaciones vamos a definir un delay mediante la función <code>CRONO_delayMs(1000)</code>. Incluya también la macro para imprimir mensajes por el monitor serie, <code>ESP_LOGI(TAG, "test/topic1, mensaje %s", msg)</code>.</p>
</li>
</ol><ol>
<li><p>Abra una terminal (si el SDK está instalado en Windows use ESP-IDF Power Shell) en el directorio de proyecto <strong>/practica1</strong> para compilar y descargar el firmware mediante <code>idf.py -p [puerto_PC] flash</code>. Luego, desde la misma terminal corra  <code>idf.py -p [puerto_PC] monitor</code>.</p>
</li>
<li><p>En la terminal de linux donde está escuchado cliente mosquitto  (asegure que esté subscripto al topic <code>"test/topic1"</code>) verifique que comienzan a recibirse los mensajes publicados por el ESP32.</p>
</li>
</ol><h3 id="actividad-3:-guardar-mensajes-mqtt"><a name="actividad-3:-guardar-mensajes-mqtt" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#actividad-3:-guardar-mensajes-mqtt"></a>Actividad 3: Guardar mensajes MQTT</h3><p>Para guardar en un archivo de texto los mensajes recibidos en el cliente suscriptor de nuestra PC, se puede utilizar un script de bash para automatiar la recepción de mensajes.</p><ol>
<li><p>Elija un directorio y desde un editor de texto cree un archivo con nombre  <strong>guardar_mensajes.sh</strong>. Luego otorgue permisos de ejecución:</p>
<pre><code class="console hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;console&quot;&gt;$ chmod +x guardar_mensajes.sh
&lt;/code&gt;&lt;/pre&gt;">$ chmod +x guardar_mensajes.sh
</code></pre>
</li>
<li><p>Copie las siguientes líneas y agréguelas dentro del archivo:</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;##!/bin/bash
# Configuración del broker y topic a escuchar.
# Configuración inicial:
broker=&quot;localhost&quot;
port=&quot;1883&quot;
topic=&quot;test/topic1&quot;
archivo=&quot;recibidos.txt&quot;
#--------------------------------------------------
# Ponemos el cliente de mosquitto a escuchar
mosquitto_sub -t $topic -h $broker -p $port -v | while read value;    do
ts=$(date &quot;+%d/%m/%Y %H:%M:%S&quot;) # Agregamos una marca de tiempo en la variable ts (opcional).
# Guardamos valores:
echo &quot;$ts $value&quot; &amp;gt;&amp;gt; $archivo   # guardamos datos en archivo
echo &quot;$value&quot;                  # mostramos el resultado por consola
done
&lt;/code&gt;&lt;/pre&gt;">##!/bin/bash
# Configuración del broker y topic a escuchar.
# Configuración inicial:
broker="localhost"
port="1883"
topic="test/topic1"
archivo="recibidos.txt"
#--------------------------------------------------
# Ponemos el cliente de mosquitto a escuchar
mosquitto_sub -t $topic -h $broker -p $port -v | while read value;    do
ts=$(date "+%d/%m/%Y %H:%M:%S") # Agregamos una marca de tiempo en la variable ts (opcional).
# Guardamos valores:
echo "$ts $value" &gt;&gt; $archivo   # guardamos datos en archivo
echo "$value"                  # mostramos el resultado por consola
done
</code></pre><p>A partir de este ejemplo, se podrá guardar la información de forma customizada de acuerdo con el formato deseado.</p>
</li>
<li><p>Finalmente, verificando que el nodo publisher esté emitiendo mensajes, ejecute en la terminal de la PC el script <code>./guardar_mensajes.sh</code>. Déjelo algunos segundos y luego interrúmpalo para verificar si se guardaron los datos en el archivo <strong>recibidos.txt</strong>.</p>
</li>
</ol><h3 id="actividad-4:-cliente-esp32---subscriber"><a name="actividad-4:-cliente-esp32---subscriber" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#actividad-4:-cliente-esp32---subscriber"></a>Actividad 4: Cliente ESP32 - subscriber</h3><ol>
<li><p>En el mismo código del cliente MQTT del ESP32, vamos a agregar la subscripción al broker para el topic <code>"test/led"</code>.  Para ello primero debemos configurar la subscripción mediante la función de la APID, <code>MQTT_subscribe("test/led")</code>, agregándola debajo de la configuración inicial de MQTT (fuera de while).</p>
</li>
<li><p>Para definir las acciones a ejecutar cada vez que el ESP32 recibe un mensaje asociado a ese topic, debemos realizar las siguientes modificaciones en el código:</p>
<ul>
<li><p>En <strong>mqtt.c</strong>, la función <code>MQTT_processTopic()</code> permite ejecutar las acciones que correspondan en el momento que se recibe un mensaje. Defina dentro de esta función el siguiente código:</p>
<pre><code class="c hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;C&quot;&gt;if(strcmp(&quot;test/led&quot;, topic)==0) {
 printf(&quot;MQTT: Mensaje recibido: %s\n&quot;, data);
 IO_toggleLed();
}
&lt;/code&gt;&lt;/pre&gt;"><span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(<span class="hljs-string">"test/led"</span>, topic)==<span class="hljs-number">0</span>) {
 <span class="hljs-built_in">printf</span>(<span class="hljs-string">"MQTT: Mensaje recibido: %s\n"</span>, data);
 IO_toggleLed();
}
</code></pre>
</li>
<li><p>En <strong>main.c</strong>, agregar la inicialización de GIPOs (por defecto se inicializa solo el LED del ESP32):</p>
<pre><code class="c hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;c&quot;&gt;IO_gpioInit();
&lt;/code&gt;&lt;/pre&gt;">IO_gpioInit();
</code></pre>
</li>
</ul>
<p>Luego compile, cargue el firmware y ejecute el monitor en la consola de trabajo del ESP32. <em>Nota: recuerde que debe chequear que el puerto GPIO asociado al LED de su Kit ESP32 (puerto 2 para NodeMCU-32S)</em>.</p>
</li>
<li><p>En otra terminal,  publique el mensaje  <code>"desde el cliente PC"</code> asociado al topic <code>"test/led"</code> . Publique varias veces ese mismo mensaje desde la PC  y observe el estado del LED y del monitor serie. Chequee que el LED cambie de estado y el mensaje recibido se muestre correctamente en el monitor.</p>
<pre><code class="console hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;console&quot;&gt;$ mosquitto_pub -h localhost -t &quot;test/led&quot; -m &quot;desde el cliente PC&quot;
&lt;/code&gt;&lt;/pre&gt;">$ mosquitto_pub -h localhost -t "test/led" -m "desde el cliente PC"
</code></pre>
</li>
</ol><h3 id="actividad-5:-brokers-remotos"><a name="actividad-5:-brokers-remotos" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#actividad-5:-brokers-remotos"></a>Actividad 5: Brokers remotos</h3><p>En los ejemplos anteriores publicamos y nos subscribimos a mensajes a través de un broker corriendo en una PC conectada a nuestra red privada. Además de esto el protocolo nos permite  intercambiar mensajes entre clientes conectados a redes distintas mediante la subscripción a brokers alojados en la nube, ya sea a través servidores privados o públicos. A continuación se muestra una lista de algunos brokers públicos disponibles:</p><table>
<thead>
<tr>
<th>Name</th>
<th>Broker Address</th>
<th>Regular/TCP Port</th>
<th>Web Socket Port</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mosquitto</td>
<td>test.mosquitto.org</td>
<td>1883</td>
<td>80</td>
<td><a href="http://test.mosquitto.org/">http://test.mosquitto.org/</a></td>
</tr>
<tr>
<td>HiveMQ</td>
<td>broker.hivemq.com</td>
<td>1883</td>
<td>8000</td>
<td><a href="https://www.hivemq.com/try-out/">https://www.hivemq.com/try-out/</a></td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table><ol>
<li><p>En el archivo de configuración del ESP32, <strong>conifg.h</strong> modifique la dirección del broker por alguna de las indicadas en la tabla, por ejemplo <code>test.mosquitto.org</code>. Luego programe el nodo y corra el monitor serie.</p>
<pre><code class="c hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;c&quot;&gt;/*  Configuracion MQTT  */
#define IP_BROKER_MQTT &quot;test.mosquitto.org&quot;      // CONFIG_IP_BROKER_MQTT
&lt;/code&gt;&lt;/pre&gt;"><span class="hljs-comment">/*  Configuracion MQTT  */</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> IP_BROKER_MQTT "test.mosquitto.org"      <span class="hljs-comment">// CONFIG_IP_BROKER_MQTT</span></span>
</code></pre>
</li>
<li><p>Desde una terminal, publique el mensaje para prender el led, en el topic <code>"test/led"</code> pero para el mismo broker configurado previamente:</p>
<pre><code class="console hljs" data-origin="&lt;pre&gt;&lt;code class=&quot;console&quot;&gt; $ mosquitto_pub -h test.mosquitto.org -t &quot;test/led&quot; -m &quot;mensaje a través de broker MQTT remoto&quot;
&lt;/code&gt;&lt;/pre&gt;"> $ mosquitto_pub -h test.mosquitto.org -t "test/led" -m "mensaje a través de broker MQTT remoto"
</code></pre>
<p>Luego verifique si se recibe el mensaje en el nodo, observando el estado del LED y monitor serie cada vez que repita el mensaje publicado (preste atención al retardo producido en comparación con los ejemplos anteriores).</p>
</li>
</ol><h3 id="actividad-6:-cliente-desde-una-app"><a name="actividad-6:-cliente-desde-una-app" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#actividad-6:-cliente-desde-una-app"></a>Actividad 6: Cliente desde una App</h3><p>Existen varias aplicaciones para teléfonos móviles que funcionan como clientes MQTT. Para esta actividad nos basaremos en la app <em>LinearMQTT</em>. Ésta permite configurar diferentes dashboards tanto para la subscripción como para la publicación. Veamos algunos ejemplos.</p><ol>
<li><p>Instale la app LinearMQTT en su teléfono celular (solo Android).</p>
<p align="center"><br><img src="./practica1_2023_files/Practica1_7_1.png" width="100"><br></p>
</li>
<li><p>Vuelva a configurar la IP del broker local en el ESP32.</p>
</li>
<li><p>Una vez abierta la aplicación, vamos a configurar la conexión MQTT desde <em>App settings</em>, ingresando la dirección del broker local y el puerto por default (1883).</p>
<p align="center"><br><img src="./practica1_2023_files/Practica1_7_2.png" width="400"><br></p>
</li>
<li><p>Primero presione <em>pausa</em>  y luego abra la configuración para un nuevo Widget asociado a un topic, presionando <strong>+</strong>.</p>
<p align="center"><br><img src="./practica1_2023_files/Practica1_7_3.png" width="800"><br></p>
</li>
<li><p>Elija el tipo de Widget. En este caso, dado que vamos a leer la señal de RSSI que enviará el nodo, elijamos el Widget <em>Meter</em>.</p>
</li>
<li><p>Ingrese el nombre del Widget (<em>Name</em>), supongamos <strong>“rssi”</strong>, el topic correspondiente (<em>Sub.topic</em>), <code>"test/topic1"</code>, y el rango mínimo y máximo de nuestro Meter (cada tipo de Widget tendrá sus parámetros particulares), en este caso asumamos desde -100 hasta 0 (recordando que son dBm). Asegure que el ESP32 esté transmitiendo los valores de RSSI en el topic correspondiente. <em><strong>Importante</strong>: tenga en cuenta que si el Widget está asociado a mensajes numéricos, el mensaje publicado por el nodo debe ser un string solo con el valor numérico del dato que se quiere transmitir, sin texto adicional</em>.</p>
<p align="center"><br><img src="./practica1_2023_files/copia-Practica1_7_5.png" width="400"><br></p>
</li>
<li><p>Una vez configurada la App, puede iniciar nuevamente la conexión a MQTT (presione <em>play</em>). Debería observarse algo como lo siguiente:</p>
<p align="center"><br><img src="./practica1_2023_files/Practica1_7_6.png" width="200"><br></p>


</li>
</ol><ol>
<li><p>Como último ejemplo, agregue el Widget <em>Buttons set</em> y configure el topic <code>"test/led"</code> (<em>Pub.topic</em>). Agregue en <em>Values and labels</em> el mensaje <code>"desde el cel"</code> y guarde los cambios. Vuelva a iniciar con <em>play</em> y  presione en forma reiterada el Boton agregado. Observe la respuesta del ESP32 y la salida del monitor serie.</p>
</li>
<li><p>Algunas otras Apps similares:</p>
<p><strong>Nolinear MQTT</strong></p>
<p align="center"><br><img src="./practica1_2023_files/nolinear_mqtt.png" width="160"><br></p>

<p><strong>IoT MQTT Panel</strong></p>
<p align="center"><br><img src="./practica1_2023_files/iot_mqtt_panel_2.png" width="350"><br></p>



</li>
</ol><h1 id="engregable-1"><a name="engregable-1" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#engregable-1"></a>Engregable 1</h1><h4 id="requerimientos-de-la-actividad:"><a name="requerimientos-de-la-actividad:" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#requerimientos-de-la-actividad:"></a>Requerimientos de la actividad:</h4><ol>
<li><p>Implemente un sistema que permita iniciar y apagar desde el celular la captura de datos en el ESP32. Los datos que debe publicar el nodo son el nivel de potencia RSSI cada 500 ms. Estos datos deben mostrarse en tiempo real en la App LinearMQTT (o la que elija) mediante el Widget Graph, como el que se muestra en la sigueinte figura.</p>
<p align="center"><br><img src="./practica1_2023_files/entregable_graph.png" width="250"><br></p>

<p><em>Nota: si luego de configurar todos los parámetros no se observa el gráfico, pruebe reiniciando la App</em>.</p>
</li>
<li><p>Debe utilizarse un Widtget de tipo “LED” en el mismo <em>TAB</em> de la App. El LED deberá prenderse cuando el nodo haya comenzado a publicar datos y apagarse cuando deje de hacerlo.</p>
</li>
<li><p>Utilizar una PC que se suscriba a los mensajes con las lecturas RSSI del nodo y guardarlos en un archivo de texto especificando en cada linea fecha/hora y valor recibido, ejemplo: <code>RSSI: -45 [dBm] 01/03/2023 14:43:05</code>. Procure capturar los mensajes durante al menos 2 o 3 minutos.</p>
</li>
</ol><h4 id="formato-de-entrega:"><a name="formato-de-entrega:" href="https://campus2.fi.uba.ar/pluginfile.php/17525/mod_resource/content/33/practica1_2023.html#formato-de-entrega:"></a>Formato de entrega:</h4><p>Debe subirse al campus (Para la tarea <strong>Entregable 1</strong>) un archivo ZIP que contenga los siguientes archivos:</p><ol>
<li>Un  PDF que muestre las capturas de la App (pulsador + Graph con varias lecturas recibidas y el LED de nivel en al menos dos situaciones, encendido y apagado) y algunas capturas en la terminal de la PC con los mensajes recibidos desde el nodo. Agregue debajo de cada figura, o en una conclusion general, los comentarios o aclaraciones que considere pertinentes.</li>
<li>Archivo de texto con los mensajes recibidos en la PC de acuerdo al formato especificado.</li>
<li>Carpeta del proyecto que contenga el código utilizado en el nodo.</li>
</ol>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com/" target="_blank">haroopad</a></footer>


</body></html>